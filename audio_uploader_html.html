<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoundSpace - Share Your Sound</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #581c87 50%, #0f172a 100%);
            min-height: 100vh;
            color: white;
            padding: 2rem;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 3rem; }
        .logo { font-size: 4rem; margin-bottom: 1rem; }
        h1 {
            font-size: 3.5rem;
            font-weight: 900;
            background: linear-gradient(to right, #c084fc, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }
        .subtitle { color: #9ca3af; font-size: 1.2rem; }
        .nav { display: flex; gap: 1rem; justify-content: center; margin-bottom: 2rem; flex-wrap: wrap; }
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.75rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }
        .btn-primary {
            background: linear-gradient(to right, #a855f7, #ec4899);
            color: white;
            box-shadow: 0 10px 25px rgba(168, 85, 247, 0.5);
        }
        .btn-primary:hover { transform: scale(1.05); }
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #d1d5db;
            backdrop-filter: blur(10px);
        }
        .btn-secondary:hover { background: rgba(255, 255, 255, 0.2); }
        .btn-green { background: linear-gradient(to right, #10b981, #059669); color: white; }
        .btn-orange { background: linear-gradient(to right, #f97316, #ea580c); color: white; }
        
        .upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 1.5rem;
            padding: 4rem 2rem;
            text-align: center;
            cursor: pointer;
            margin-bottom: 2rem;
            background: rgba(255, 255, 255, 0.05);
            transition: all 0.3s;
        }
        .upload-area:hover { background: rgba(255, 255, 255, 0.1); border-color: #a855f7; }
        .upload-area.drag-active { background: rgba(168, 85, 247, 0.2); border-color: #a855f7; }
        .upload-icon { font-size: 5rem; margin-bottom: 1rem; }
        
        .track {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s;
        }
        .track:hover { background: rgba(255, 255, 255, 0.15); border-color: rgba(168, 85, 247, 0.5); }
        .track-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; }
        .track-num { width: 2rem; text-align: center; color: #9ca3af; font-size: 0.9rem; }
        .play-btn {
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 50%;
            border: none;
            background: linear-gradient(to right, #a855f7, #ec4899);
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        .play-btn:hover { transform: scale(1.1); }
        .track-info { flex: 1; cursor: pointer; }
        .track-title { font-size: 1.1rem; font-weight: bold; margin-bottom: 0.25rem; }
        .track-meta { font-size: 0.9rem; color: #9ca3af; }
        .track-duration { font-size: 0.8rem; color: #6b7280; margin-top: 0.25rem; }
        .track-stats {
            display: flex;
            gap: 1.5rem;
            padding: 0.75rem 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 0.75rem;
            font-size: 0.9rem;
            color: #9ca3af;
        }
        .track-stat { display: flex; align-items: center; gap: 0.5rem; }
        .track-actions { display: flex; gap: 0.5rem; flex-wrap: wrap; }
        
        .icon-btn {
            padding: 0.5rem 1rem;
            border: 1px solid;
            border-radius: 0.5rem;
            background: transparent;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
            white-space: nowrap;
        }
        .btn-download { color: #10b981; border-color: rgba(16, 185, 129, 0.5); }
        .btn-download:hover { background: rgba(16, 185, 129, 0.2); }
        .btn-like { color: #ec4899; border-color: rgba(236, 72, 153, 0.5); }
        .btn-like:hover { background: rgba(236, 72, 153, 0.2); }
        .btn-like.liked { background: rgba(236, 72, 153, 0.3); }
        .btn-share { color: #3b82f6; border-color: rgba(59, 130, 246, 0.5); }
        .btn-share:hover { background: rgba(59, 130, 246, 0.2); }
        .btn-delete { color: #ef4444; border-color: rgba(239, 68, 68, 0.5); }
        .btn-delete:hover { background: rgba(239, 68, 68, 0.2); }
        .btn-comment { color: #a855f7; border-color: rgba(168, 85, 247, 0.5); }
        .btn-comment:hover { background: rgba(168, 85, 247, 0.2); }
        
        .comments-section {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        .comment {
            display: flex;
            gap: 0.75rem;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .comment-avatar {
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            background: linear-gradient(135deg, #a855f7, #ec4899);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            flex-shrink: 0;
            background-size: cover;
            background-position: center;
            overflow: hidden;
        }
        .comment-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .upload-img-btn {
            display: inline-block;
            padding: 0.5rem 1rem;
            background: rgba(168, 85, 247, 0.2);
            border: 1px solid rgba(168, 85, 247, 0.5);
            border-radius: 0.5rem;
            color: #c084fc;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 0.5rem;
            transition: all 0.3s;
        }
        .upload-img-btn:hover {
            background: rgba(168, 85, 247, 0.3);
        }
        .comment-content { flex: 1; }
        .comment-author { font-weight: bold; font-size: 0.9rem; margin-bottom: 0.25rem; }
        .comment-text { font-size: 0.85rem; color: #d1d5db; }
        .comment-input {
            width: 100%;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.5rem;
            color: white;
            margin-top: 0.5rem;
        }
        
        .empty-state { text-align: center; padding: 5rem 2rem; color: #9ca3af; }
        .empty-icon { font-size: 4rem; opacity: 0.5; margin-bottom: 1rem; }
        input[type="file"] { display: none; }
        
        select, input[type="text"], textarea {
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.5rem;
            color: white;
            width: 100%;
            font-size: 1rem;
        }
        select { cursor: pointer; width: auto; }
        
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            overflow-y: auto;
            padding: 2rem;
        }
        .modal-content {
            background: linear-gradient(135deg, #1e293b, #0f172a);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            padding: 2rem;
            width: 90%;
            max-width: 500px;
        }
        .modal-content h3 { margin-bottom: 1.5rem; font-size: 1.5rem; }
        .modal-content input, .modal-content textarea { margin-bottom: 1rem; }
        .modal-actions { display: flex; gap: 0.75rem; margin-top: 1.5rem; }
        
        .playlist-badge {
            padding: 0.5rem 1.25rem;
            border-radius: 2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            margin: 0.25rem;
        }
        .playlist-badge.active { background: linear-gradient(to right, #3b82f6, #06b6d4); color: white; }
        .playlist-badge:not(.active) { background: rgba(255, 255, 255, 0.1); color: #d1d5db; }
        .playlists { display: flex; gap: 0.5rem; justify-content: center; margin-bottom: 2rem; flex-wrap: wrap; }
        
        audio { display: none; }
        
        .profile-header {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            display: flex;
            gap: 2rem;
            align-items: center;
            flex-wrap: wrap;
            position: relative;
            overflow: hidden;
        }
        .profile-header::before {
            content: '';
            position: absolute;
            inset: 0;
            background-size: cover;
            background-position: center;
            opacity: 0.3;
            z-index: 0;
        }
        .profile-header > * {
            position: relative;
            z-index: 1;
        }
        .profile-header.has-bg::before {
            opacity: 0.6;
        }
        .profile-avatar {
            width: 8rem;
            height: 8rem;
            border-radius: 50%;
            background: linear-gradient(135deg, #a855f7, #ec4899);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            flex-shrink: 0;
            background-size: cover;
            background-position: center;
            overflow: hidden;
        }
        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .profile-info { flex: 1; min-width: 250px; }
        .profile-name { font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem; }
        .profile-bio { color: #9ca3af; margin-bottom: 1rem; line-height: 1.6; }
        .profile-stats {
            display: flex;
            gap: 2rem;
            font-size: 0.9rem;
            color: #d1d5db;
            flex-wrap: wrap;
        }
        .profile-stat strong { color: white; display: block; font-size: 1.5rem; }
        
        .profile-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .profile-card {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        .profile-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-4px);
        }
        .profile-card-avatar {
            width: 4rem;
            height: 4rem;
            border-radius: 50%;
            background: linear-gradient(135deg, #a855f7, #ec4899);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin: 0 auto 1rem;
            background-size: cover;
            background-position: center;
            overflow: hidden;
        }
        .profile-card-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .profile-card-name { font-size: 1.1rem; font-weight: bold; margin-bottom: 0.5rem; }
        .profile-card-stats { font-size: 0.9rem; color: #9ca3af; }
        
        .user-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: rgba(168, 85, 247, 0.2);
            border: 1px solid rgba(168, 85, 247, 0.5);
            border-radius: 1rem;
            font-size: 0.9rem;
            color: #c084fc;
            margin-left: 0.5rem;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            margin-bottom: 1rem;
        }
        .checkbox-label input[type="checkbox"] { width: auto; }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .profile-dropdown {
            position: fixed;
            top: 2rem;
            right: 2rem;
            z-index: 100;
        }
        .profile-trigger {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.25rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 2rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        .profile-trigger:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }
        .profile-trigger-avatar {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            background: linear-gradient(135deg, #a855f7, #ec4899);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            background-size: cover;
            background-position: center;
            overflow: hidden;
        }
        .profile-trigger-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .profile-trigger-name { font-weight: 600; color: white; }
        .profile-menu {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 0.5rem;
            background: linear-gradient(135deg, #1e293b, #0f172a);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 1rem;
            padding: 0.5rem;
            min-width: 220px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }
        .profile-menu.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        .profile-menu-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: white;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            background: transparent;
            width: 100%;
            text-align: left;
            font-size: 0.95rem;
        }
        .profile-menu-item:hover { background: rgba(168, 85, 247, 0.2); }
        .profile-menu-divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 0.5rem 0;
        }
        
        .waveform {
            height: 60px;
            background: rgba(168, 85, 247, 0.1);
            border-radius: 0.5rem;
            margin: 0.75rem 0;
            position: relative;
            overflow: hidden;
        }
        .waveform-bars {
            display: flex;
            align-items: center;
            justify-content: space-around;
            height: 100%;
            padding: 0 0.5rem;
        }
        .waveform-bar {
            width: 3px;
            background: linear-gradient(to top, #a855f7, #ec4899);
            border-radius: 2px;
            animation: wave 1.5s ease-in-out infinite;
        }
        @keyframes wave {
            0%, 100% { height: 20%; }
            50% { height: 80%; }
        }
        
        .follow-btn {
            padding: 0.5rem 1.5rem;
            background: linear-gradient(to right, #a855f7, #ec4899);
            border: none;
            border-radius: 2rem;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .follow-btn:hover { transform: scale(1.05); }
        .follow-btn.following {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .genre-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }
        .genre-tag {
            padding: 0.25rem 0.75rem;
            background: rgba(168, 85, 247, 0.2);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 1rem;
            font-size: 0.75rem;
            color: #c084fc;
        }
        
        .trending-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: linear-gradient(to right, #f59e0b, #ef4444);
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: bold;
            margin-left: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="profile-dropdown">
        <div class="profile-trigger" id="profile-trigger">
            <div class="profile-trigger-avatar" id="profile-avatar">üéß</div>
            <div class="profile-trigger-name" id="profile-name">Music Lover</div>
            <div>‚ñº</div>
        </div>
        <div class="profile-menu" id="profile-menu">
            <button class="profile-menu-item" id="menu-profile">
                <span>üë§</span>
                <span>My Profile</span>
            </button>
            <button class="profile-menu-item" id="menu-library">
                <span>üéº</span>
                <span>My Library</span>
            </button>
            <button class="profile-menu-item" id="menu-create">
                <span>‚ûï</span>
                <span>Upload Track</span>
            </button>
            <div class="profile-menu-divider"></div>
            <button class="profile-menu-item" id="menu-playlist">
                <span>üìÄ</span>
                <span>Create Playlist</span>
            </button>
            <button class="profile-menu-item" id="menu-edit">
                <span>‚úèÔ∏è</span>
                <span>Edit Profile</span>
            </button>
            <button class="profile-menu-item" id="menu-settings">
                <span>‚öôÔ∏è</span>
                <span>Settings</span>
            </button>
            <div class="profile-menu-divider"></div>
            <button class="profile-menu-item" id="menu-following">
                <span>üíñ</span>
                <span>Following</span>
            </button>
            <button class="profile-menu-item" id="menu-stats">
                <span>üìä</span>
                <span>My Stats</span>
            </button>
            <button class="profile-menu-item" id="menu-export">
                <span>üíæ</span>
                <span>Export Data</span>
            </button>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <div class="logo">üéµ</div>
            <h1>SoundSpace</h1>
            <p class="subtitle">Share Your Sound. Download Freely.</p>
        </div>

        <div class="nav">
            <button class="btn btn-primary" onclick="app.setView('discover')">üåç Discover</button>
            <button class="btn btn-secondary" onclick="app.setView('trending')">üî• Trending</button>
            <button class="btn btn-secondary" onclick="app.setView('following')">üíñ Following</button>
        </div>

        <div id="main-content"></div>
        <audio id="audio-player"></audio>
    </div>

    <script>
        const app = {
            tracks: [],
            playlists: [],
            users: [],
            currentUser: null,
            currentPlayingId: null,
            view: 'discover',
            viewingUserId: null,
            following: [],
            likes: {},
            comments: {},
            plays: {},

            init() {
                // Load or create user
                const savedUsers = localStorage.getItem('soundspace_users');
                if (savedUsers) this.users = JSON.parse(savedUsers);
                
                const savedCurrentUser = localStorage.getItem('soundspace_current_user');
                if (savedCurrentUser) {
                    this.currentUser = JSON.parse(savedCurrentUser);
                } else {
                    this.currentUser = {
                        id: Math.random().toString(36).slice(2),
                        name: 'Music Lover',
                        bio: 'Just here to share great music!',
                        avatar: 'üéß',
                        profilePicture: null,
                        backgroundImage: null,
                        followers: 0,
                        following: 0,
                        createdAt: new Date().toISOString()
                    };
                    this.saveCurrentUser();
                }

                // Load user data
                this.loadUserData();
                this.updateProfileDisplay();

                const audio = document.getElementById('audio-player');
                audio.onended = () => {
                    this.currentPlayingId = null;
                    this.render();
                };

                this.setupProfileDropdown();
                this.render();
            },

            loadUserData() {
                this.tracks = JSON.parse(localStorage.getItem(`soundspace_tracks_${this.currentUser.id}`) || '[]');
                this.playlists = JSON.parse(localStorage.getItem(`soundspace_playlists_${this.currentUser.id}`) || '[]');
                this.following = JSON.parse(localStorage.getItem(`soundspace_following_${this.currentUser.id}`) || '[]');
                this.likes = JSON.parse(localStorage.getItem(`soundspace_likes_${this.currentUser.id}`) || '{}');
                this.comments = JSON.parse(localStorage.getItem(`soundspace_comments`) || '{}');
                this.plays = JSON.parse(localStorage.getItem(`soundspace_plays`) || '{}');
            },

            saveData() {
                localStorage.setItem(`soundspace_tracks_${this.currentUser.id}`, JSON.stringify(this.tracks));
                localStorage.setItem(`soundspace_playlists_${this.currentUser.id}`, JSON.stringify(this.playlists));
                localStorage.setItem(`soundspace_following_${this.currentUser.id}`, JSON.stringify(this.following));
                localStorage.setItem(`soundspace_likes_${this.currentUser.id}`, JSON.stringify(this.likes));
                localStorage.setItem(`soundspace_comments`, JSON.stringify(this.comments));
                localStorage.setItem(`soundspace_plays`, JSON.stringify(this.plays));
                
                const userIndex = this.users.findIndex(u => u.id === this.currentUser.id);
                if (userIndex >= 0) {
                    this.users[userIndex] = this.currentUser;
                } else {
                    this.users.push(this.currentUser);
                }
                localStorage.setItem('soundspace_users', JSON.stringify(this.users));
            },

            saveCurrentUser() {
                localStorage.setItem('soundspace_current_user', JSON.stringify(this.currentUser));
                this.saveData();
            },

            setupProfileDropdown() {
                const trigger = document.getElementById('profile-trigger');
                const menu = document.getElementById('profile-menu');
                
                trigger.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    menu.classList.toggle('active');
                });

                document.addEventListener('click', (e) => {
                    if (!document.querySelector('.profile-dropdown').contains(e.target)) {
                        menu.classList.remove('active');
                    }
                });

                document.getElementById('menu-profile').addEventListener('click', () => {
                    this.setView('profile', this.currentUser.id);
                    menu.classList.remove('active');
                });
                document.getElementById('menu-library').addEventListener('click', () => {
                    this.setView('library');
                    menu.classList.remove('active');
                });
                document.getElementById('menu-create').addEventListener('click', () => {
                    this.setView('library');
                    menu.classList.remove('active');
                });
                document.getElementById('menu-playlist').addEventListener('click', () => {
                    this.showCreatePlaylist();
                    menu.classList.remove('active');
                });
                document.getElementById('menu-edit').addEventListener('click', () => {
                    this.showEditProfile();
                    menu.classList.remove('active');
                });
                document.getElementById('menu-settings').addEventListener('click', () => {
                    this.showSettings();
                    menu.classList.remove('active');
                });
                document.getElementById('menu-following').addEventListener('click', () => {
                    this.setView('following');
                    menu.classList.remove('active');
                });
                document.getElementById('menu-stats').addEventListener('click', () => {
                    this.showStats();
                    menu.classList.remove('active');
                });
                document.getElementById('menu-export').addEventListener('click', () => {
                    this.exportData();
                    menu.classList.remove('active');
                });
            },

            updateProfileDisplay() {
                const avatarEl = document.getElementById('profile-avatar');
                if (this.currentUser.profilePicture) {
                    avatarEl.innerHTML = `<img src="${this.currentUser.profilePicture}" alt="Profile">`;
                } else {
                    avatarEl.textContent = this.currentUser.avatar;
                }
                document.getElementById('profile-name').textContent = this.currentUser.name;
            },

            handleImageUpload(file, type) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            },

            handleFiles(files) {
                Array.from(files).forEach(file => {
                    if (file.type.startsWith('audio/') || /\.(mp3|m4a)$/i.test(file.name)) {
                        const track = {
                            id: Math.random().toString(36).slice(2),
                            file,
                            url: URL.createObjectURL(file),
                            title: file.name.replace(/\.(mp3|m4a)$/i, ''),
                            artist: this.currentUser.name,
                            genre: 'Electronic',
                            description: '',
                            duration: null,
                            isPlaying: false,
                            userId: this.currentUser.id,
                            uploadedAt: new Date().toISOString(),
                            likes: 0,
                            plays: 0,
                            downloads: 0
                        };
                        this.tracks.push(track);
                        
                        const audio = document.createElement('audio');
                        audio.src = track.url;
                        audio.onloadedmetadata = () => {
                            track.duration = audio.duration;
                            this.saveData();
                            this.render();
                        };
                    }
                });
                this.saveData();
                this.render();
            },

            togglePlay(trackId) {
                const track = this.getAllTracks().find(t => t.id === trackId);
                const audio = document.getElementById('audio-player');

                if (this.currentPlayingId === trackId) {
                    if (audio.paused) {
                        audio.play();
                    } else {
                        audio.pause();
                    }
                } else {
                    audio.src = track.url;
                    audio.play();
                    this.currentPlayingId = trackId;
                    
                    // Increment play count
                    if (!this.plays[trackId]) this.plays[trackId] = 0;
                    this.plays[trackId]++;
                    track.plays = this.plays[trackId];
                    this.saveData();
                }
                this.render();
            },

            toggleLike(trackId) {
                if (!this.likes[trackId]) {
                    this.likes[trackId] = true;
                } else {
                    delete this.likes[trackId];
                }
                this.saveData();
                this.render();
            },

            addComment(trackId, text) {
                if (!this.comments[trackId]) this.comments[trackId] = [];
                this.comments[trackId].push({
                    id: Math.random().toString(36).slice(2),
                    userId: this.currentUser.id,
                    userName: this.currentUser.name,
                    avatar: this.currentUser.avatar,
                    userProfilePic: this.currentUser.profilePicture,
                    text: text,
                    createdAt: new Date().toISOString()
                });
                this.saveData();
                this.render();
            },

            downloadTrack(trackId) {
                const track = this.getAllTracks().find(t => t.id === trackId);
                const a = document.createElement('a');
                a.href = track.url;
                a.download = `${track.title}.mp3`;
                a.click();
                
                // Increment download count
                track.downloads = (track.downloads || 0) + 1;
                this.saveData();
            },

            shareTrack(trackId) {
                const track = this.getAllTracks().find(t => t.id === trackId);
                const shareText = `Check out "${track.title}" by ${track.artist} on SoundSpace!`;
                
                if (navigator.share) {
                    navigator.share({ title: track.title, text: shareText });
                } else {
                    navigator.clipboard.writeText(shareText);
                    alert('Link copied to clipboard!');
                }
            },

            followUser(userId) {
                if (this.following.includes(userId)) {
                    this.following = this.following.filter(id => id !== userId);
                } else {
                    this.following.push(userId);
                }
                this.saveData();
                this.render();
            },

            deleteTrack(trackId) {
                const track = this.tracks.find(t => t.id === trackId);
                if (track && track.url) URL.revokeObjectURL(track.url);
                this.tracks = this.tracks.filter(t => t.id !== trackId);
                this.playlists.forEach(p => p.trackIds = p.trackIds.filter(id => id !== trackId));
                if (this.currentPlayingId === trackId) {
                    document.getElementById('audio-player').pause();
                    this.currentPlayingId = null;
                }
                this.saveData();
                this.render();
            },

            getAllTracks() {
                const allTracks = [...this.tracks];
                this.users.forEach(user => {
                    if (user.id !== this.currentUser.id) {
                        const userTracks = JSON.parse(localStorage.getItem(`soundspace_tracks_${user.id}`) || '[]');
                        allTracks.push(...userTracks);
                    }
                });
                return allTracks;
            },

            getTrendingTracks() {
                return this.getAllTracks()
                    .sort((a, b) => (b.plays || 0) - (a.plays || 0))
                    .slice(0, 20);
            },

            getFollowingTracks() {
                const tracks = [];
                this.following.forEach(userId => {
                    const userTracks = JSON.parse(localStorage.getItem(`soundspace_tracks_${userId}`) || '[]');
                    tracks.push(...userTracks);
                });
                return tracks.sort((a, b) => new Date(b.uploadedAt) - new Date(a.uploadedAt));
            },

            formatDuration(seconds) {
                if (!seconds) return '--:--';
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            },

            setView(view, userId = null) {
                this.view = view;
                this.viewingUserId = userId;
                this.render();
            },

            showEditProfile() {
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.innerHTML = `
                    <div class="modal-content">
                        <h3>Edit Profile</h3>
                        <input type="text" id="profile-name-input" placeholder="Your name" value="${this.currentUser.name}">
                        <textarea id="profile-bio" placeholder="Tell us about yourself..." rows="3">${this.currentUser.bio}</textarea>
                        <input type="text" id="profile-avatar-input" placeholder="Emoji avatar (e.g., üé∏)" value="${this.currentUser.avatar}">
                        
                        <div style="margin: 1rem 0;">
                            <label class="upload-img-btn">
                                üì∑ Upload Profile Picture
                                <input type="file" id="profile-pic-upload" accept="image/*" style="display: none;">
                            </label>
                            ${this.currentUser.profilePicture ? '<p style="color: #10b981; font-size: 0.9rem; margin-top: 0.5rem;">‚úì Profile picture uploaded</p>' : ''}
                        </div>
                        
                        <div style="margin: 1rem 0;">
                            <label class="upload-img-btn">
                                üñºÔ∏è Upload Background Image
                                <input type="file" id="background-upload" accept="image/*" style="display: none;">
                            </label>
                            ${this.currentUser.backgroundImage ? '<p style="color: #10b981; font-size: 0.9rem; margin-top: 0.5rem;">‚úì Background image uploaded</p>' : ''}
                        </div>
                        
                        <div class="modal-actions">
                            <button class="btn btn-primary" style="flex:1" onclick="app.updateProfile()">Save</button>
                            <button class="btn btn-secondary" style="flex:1" onclick="this.closest('.modal').remove()">Cancel</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
                
                // Setup image upload handlers
                document.getElementById('profile-pic-upload').addEventListener('change', async (e) => {
                    if (e.target.files[0]) {
                        const imageData = await this.handleImageUpload(e.target.files[0]);
                        this.currentUser.profilePicture = imageData;
                        e.target.parentElement.nextElementSibling?.remove();
                        const success = document.createElement('p');
                        success.style.cssText = 'color: #10b981; font-size: 0.9rem; margin-top: 0.5rem;';
                        success.textContent = '‚úì Profile picture uploaded';
                        e.target.parentElement.after(success);
                    }
                });
                
                document.getElementById('background-upload').addEventListener('change', async (e) => {
                    if (e.target.files[0]) {
                        const imageData = await this.handleImageUpload(e.target.files[0]);
                        this.currentUser.backgroundImage = imageData;
                        e.target.parentElement.nextElementSibling?.remove();
                        const success = document.createElement('p');
                        success.style.cssText = 'color: #10b981; font-size: 0.9rem; margin-top: 0.5rem;';
                        success.textContent = '‚úì Background image uploaded';
                        e.target.parentElement.after(success);
                    }
                });
            },

            updateProfile() {
                this.currentUser.name = document.getElementById('profile-name-input').value.trim() || 'Music Lover';
                this.currentUser.bio = document.getElementById('profile-bio').value.trim() || '';
                this.currentUser.avatar = document.getElementById('profile-avatar-input').value.trim() || 'üéß';
                this.saveCurrentUser();
                this.updateProfileDisplay();
                document.querySelector('.modal').remove();
                this.render();
            },

            showCreatePlaylist() {
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.innerHTML = `
                    <div class="modal-content">
                        <h3>Create New Playlist</h3>
                        <input type="text" id="playlist-name" placeholder="Playlist name...">
                        <textarea id="playlist-desc" placeholder="Description (optional)..." rows="2"></textarea>
                        <label class="checkbox-label">
                            <input type="checkbox" id="playlist-public" checked>
                            <span>Make this playlist public</span>
                        </label>
                        <div class="modal-actions">
                            <button class="btn btn-primary" style="flex:1" onclick="app.createPlaylist()">Create</button>
                            <button class="btn btn-secondary" style="flex:1" onclick="this.closest('.modal').remove()">Cancel</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            },

            createPlaylist() {
                const name = document.getElementById('playlist-name').value.trim();
                const description = document.getElementById('playlist-desc').value.trim();
                const isPublic = document.getElementById('playlist-public').checked;
                
                if (name) {
                    this.playlists.push({
                        id: Math.random().toString(36).slice(2),
                        name,
                        description,
                        isPublic,
                        trackIds: [],
                        userId: this.currentUser.id,
                        createdAt: new Date().toISOString()
                    });
                    this.saveData();
                    document.querySelector('.modal').remove();
                    this.render();
                }
            },

            showSettings() {
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.innerHTML = `
                    <div class="modal-content">
                        <h3>‚öôÔ∏è Settings</h3>
                        <label class="checkbox-label">
                            <input type="checkbox" id="auto-play" checked>
                            <span>Auto-play next track</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="show-notifications" checked>
                            <span>Show notifications</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="public-profile" checked>
                            <span>Public profile</span>
                        </label>
                        <div class="modal-actions">
                            <button class="btn btn-primary" style="flex:1" onclick="this.closest('.modal').remove()">Done</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            },

            showStats() {
                const totalPlays = Object.values(this.plays).reduce((a, b) => a + b, 0);
                const totalLikes = Object.keys(this.likes).length;
                
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.innerHTML = `
                    <div class="modal-content">
                        <h3>üìä Your Stats</h3>
                        <div style="color: #d1d5db; line-height: 2.5;">
                            <p><strong>Total Tracks:</strong> ${this.tracks.length}</p>
                            <p><strong>Total Plays:</strong> ${totalPlays}</p>
                            <p><strong>Total Likes:</strong> ${totalLikes}</p>
                            <p><strong>Following:</strong> ${this.following.length}</p>
                            <p><strong>Playlists:</strong> ${this.playlists.length}</p>
                            <p><strong>Member Since:</strong> ${new Date(this.currentUser.createdAt).toLocaleDateString()}</p>
                        </div>
                        <div class="modal-actions">
                            <button class="btn btn-primary" style="flex:1" onclick="this.closest('.modal').remove()">Close</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            },

            exportData() {
                const data = {
                    user: this.currentUser,
                    playlists: this.playlists,
                    following: this.following,
                    exportDate: new Date().toISOString()
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `soundspace-backup-${Date.now()}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                alert('Data exported successfully!');
            },

            render() {
                const content = document.getElementById('main-content');
                
                if (this.view === 'library') {
                    content.innerHTML = this.renderLibrary();
                    this.setupLibraryEvents();
                } else if (this.view === 'discover') {
                    content.innerHTML = this.renderDiscover();
                } else if (this.view === 'trending') {
                    content.innerHTML = this.renderTrending();
                } else if (this.view === 'following') {
                    content.innerHTML = this.renderFollowing();
                } else if (this.view === 'profile') {
                    content.innerHTML = this.renderProfile(this.viewingUserId || this.currentUser.id);
                }
            },

            renderTrack(track, index) {
                const audio = document.getElementById('audio-player');
                const isLiked = this.likes[track.id];
                const trackComments = this.comments[track.id] || [];
                const isOwnTrack = track.userId === this.currentUser.id;
                
                return `
                    <div class="track">
                        <div class="track-header">
                            <div class="track-num">${track.isPlaying ? '‚ô´' : index + 1}</div>
                            <button class="play-btn" onclick="app.togglePlay('${track.id}')">
                                ${this.currentPlayingId === track.id && !audio.paused ? '‚è∏' : '‚ñ∂'}
                            </button>
                            <div class="track-info" onclick="app.setView('profile', '${track.userId}')">
                                <div class="track-title">${track.title}</div>
                                <div class="track-meta">${track.artist} ${track.genre ? `‚Ä¢ ${track.genre}` : ''}</div>
                                <div class="track-duration">‚è± ${this.formatDuration(track.duration)}</div>
                                ${track.description ? `<div class="genre-tags"><span class="genre-tag">${track.description}</span></div>` : ''}
                            </div>
                            <div class="track-actions">
                                <button class="icon-btn btn-like ${isLiked ? 'liked' : ''}" onclick="app.toggleLike('${track.id}')">
                                    ‚ù§Ô∏è ${Object.keys(this.likes).filter(k => k === track.id).length}
                                </button>
                                <button class="icon-btn btn-download" onclick="app.downloadTrack('${track.id}')">
                                    ‚¨á Download MP3
                                </button>
                                <button class="icon-btn btn-share" onclick="app.shareTrack('${track.id}')">
                                    üîó Share
                                </button>
                                <button class="icon-btn btn-comment" onclick="document.getElementById('comment-${track.id}').style.display='block'">
                                    üí¨ ${trackComments.length}
                                </button>
                                ${isOwnTrack ? `<button class="icon-btn btn-delete" onclick="app.deleteTrack('${track.id}')">üóë</button>` : ''}
                            </div>
                        </div>
                        <div class="waveform">
                            <div class="waveform-bars">
                                ${Array(40).fill(0).map((_, i) => `<div class="waveform-bar" style="animation-delay: ${i * 0.05}s; height: ${Math.random() * 60 + 20}%"></div>`).join('')}
                            </div>
                        </div>
                        <div class="track-stats">
                            <div class="track-stat">‚ñ∂Ô∏è ${track.plays || 0} plays</div>
                            <div class="track-stat">‚¨á ${track.downloads || 0} downloads</div>
                            <div class="track-stat">üìÖ ${new Date(track.uploadedAt).toLocaleDateString()}</div>
                        </div>
                        <div class="comments-section" id="comment-${track.id}" style="display: none;">
                            ${trackComments.map(c => `
                                <div class="comment">
                                    <div class="comment-avatar">
                                        ${c.userProfilePic ? `<img src="${c.userProfilePic}" alt="${c.userName}">` : c.avatar}
                                    </div>
                                    <div class="comment-content">
                                        <div class="comment-author">${c.userName}</div>
                                        <div class="comment-text">${c.text}</div>
                                    </div>
                                </div>
                            `).join('')}
                            <input type="text" class="comment-input" placeholder="Add a comment..." 
                                onkeypress="if(event.key==='Enter' && this.value.trim()) { app.addComment('${track.id}', this.value); this.value=''; }">
                        </div>
                    </div>
                `;
            },

            renderLibrary() {
                return `
                    <div class="upload-area" id="upload-area">
                        <input type="file" id="file-input" multiple accept="audio/*">
                        <div class="upload-icon">üéß</div>
                        <h2>Upload Your Music</h2>
                        <p>Drop your tracks here or click to browse</p>
                        <p style="font-size: 0.9rem; color: #9ca3af; margin-top: 1rem;">Share your music with the world. Free downloads for everyone!</p>
                    </div>
                    
                    ${this.tracks.length > 0 ? `
                        <div class="section-title">üéµ My Tracks (${this.tracks.length})</div>
                        ${this.tracks.map((track, i) => this.renderTrack(track, i)).join('')}
                    ` : `
                        <div class="empty-state">
                            <div class="empty-icon">üéµ</div>
                            <h2>No tracks yet</h2>
                            <p>Upload your first track to get started!</p>
                        </div>
                    `}
                `;
            },

            setupLibraryEvents() {
                const uploadArea = document.getElementById('upload-area');
                const fileInput = document.getElementById('file-input');
                if (!uploadArea || !fileInput) return;

                uploadArea.onclick = () => fileInput.click();
                fileInput.onchange = (e) => this.handleFiles(e.target.files);
                uploadArea.ondragover = (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('drag-active');
                };
                uploadArea.ondragleave = () => uploadArea.classList.remove('drag-active');
                uploadArea.ondrop = (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('drag-active');
                    this.handleFiles(e.dataTransfer.files);
                };
            },

            renderDiscover() {
                const allTracks = this.getAllTracks().filter(t => t.userId !== this.currentUser.id);
                return `
                    <div class="section-title">üåç Discover New Music</div>
                    <p style="color: #9ca3af; margin-bottom: 2rem; text-align: center;">Explore and download tracks from creators worldwide</p>
                    
                    ${allTracks.length > 0 ? allTracks.map((track, i) => this.renderTrack(track, i)).join('') : `
                        <div class="empty-state">
                            <div class="empty-icon">üåç</div>
                            <h2>No tracks to discover yet</h2>
                            <p>Be the first to upload and share your music!</p>
                        </div>
                    `}
                    
                    <div class="section-title" style="margin-top: 3rem;">üë• Creators</div>
                    <div class="profile-grid">
                        ${this.users.filter(u => u.id !== this.currentUser.id).map(user => {
                            const userTracks = JSON.parse(localStorage.getItem(`soundspace_tracks_${user.id}`) || '[]');
                            return `
                                <div class="profile-card" onclick="app.setView('profile', '${user.id}')">
                                    <div class="profile-card-avatar">
                                        ${user.profilePicture ? `<img src="${user.profilePicture}" alt="${user.name}">` : user.avatar}
                                    </div>
                                    <div class="profile-card-name">${user.name}</div>
                                    <div class="profile-card-stats">${userTracks.length} tracks</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            },

            renderTrending() {
                const trending = this.getTrendingTracks();
                return `
                    <div class="section-title">üî• Trending Now</div>
                    <p style="color: #9ca3af; margin-bottom: 2rem; text-align: center;">The most played tracks right now</p>
                    ${trending.length > 0 ? trending.map((track, i) => this.renderTrack(track, i)).join('') : `
                        <div class="empty-state">
                            <div class="empty-icon">üî•</div>
                            <h2>No trending tracks yet</h2>
                            <p>Start listening to see what's hot!</p>
                        </div>
                    `}
                `;
            },

            renderFollowing() {
                const tracks = this.getFollowingTracks();
                return `
                    <div class="section-title">üíñ Following Feed</div>
                    <p style="color: #9ca3af; margin-bottom: 2rem; text-align: center;">Latest tracks from artists you follow</p>
                    ${tracks.length > 0 ? tracks.map((track, i) => this.renderTrack(track, i)).join('') : `
                        <div class="empty-state">
                            <div class="empty-icon">üíñ</div>
                            <h2>Not following anyone yet</h2>
                            <p>Follow artists to see their latest uploads here!</p>
                        </div>
                    `}
                `;
            },

            renderProfile(userId) {
                const user = this.users.find(u => u.id === userId) || this.currentUser;
                const userTracks = userId === this.currentUser.id ? this.tracks : JSON.parse(localStorage.getItem(`soundspace_tracks_${userId}`) || '[]');
                const isOwnProfile = userId === this.currentUser.id;
                const isFollowing = this.following.includes(userId);
                
                return `
                    <div class="profile-header ${user.backgroundImage ? 'has-bg' : ''}" ${user.backgroundImage ? `style="background-image: url('${user.backgroundImage}')"` : ''}>
                        ${user.backgroundImage ? `<div style="position: absolute; inset: 0; background-image: url('${user.backgroundImage}'); background-size: cover; background-position: center; opacity: 0.4; z-index: 0;"></div>` : ''}
                        <div class="profile-avatar">
                            ${user.profilePicture ? `<img src="${user.profilePicture}" alt="${user.name}">` : user.avatar}
                        </div>
                        <div class="profile-info">
                            <div class="profile-name">
                                ${user.name}
                                ${isOwnProfile ? '<span class="user-badge">YOU</span>' : ''}
                            </div>
                            <div class="profile-bio">${user.bio || 'No bio yet'}</div>
                            <div class="profile-stats">
                                <div><strong>${userTracks.length}</strong> Tracks</div>
                                <div><strong>${user.followers || 0}</strong> Followers</div>
                                <div><strong>${user.following || 0}</strong> Following</div>
                            </div>
                            ${!isOwnProfile ? `
                                <button class="follow-btn ${isFollowing ? 'following' : ''}" onclick="app.followUser('${userId}')">
                                    ${isFollowing ? '‚úì Following' : '+ Follow'}
                                </button>
                            ` : ''}
                        </div>
                    </div>

                    <div class="section-title">üéµ Tracks</div>
                    ${userTracks.length > 0 ? userTracks.map((track, i) => this.renderTrack(track, i)).join('') : `
                        <div class="empty-state">
                            <div class="empty-icon">üéµ</div>
                            <p>${isOwnProfile ? 'You haven\'t uploaded any tracks yet' : 'No tracks yet'}</p>
                        </div>
                    `}
                `;
            }
        };

        app.init();
    </script>
</body>
</html>